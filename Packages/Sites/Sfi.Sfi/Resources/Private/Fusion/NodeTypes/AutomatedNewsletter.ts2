prototype(Sfi.Sfi:AutomatedNewsletter) {
	templatePath = 'resource://Sfi.Sfi/Private/Fusion/NodeTypes/AutomatedNewsletter.html'
	main = ContentCollection {
		nodePath = 'main'
	}
	logoUri = Neos.Fusion:ResourceUri {
        path = 'resource://Sfi.Sfi/Public/Images/sfi-newsletter.png'
    }
	unsubscribeLink = Sfi.Sfi:UnsubscribeLink
}

prototype(Sfi.Sfi:UnsubscribeLink) < prototype(Neos.Fusion:UriBuilder) {
	package = 'Sfi.SFi'
	controller = 'Subscription'
	action = 'unsubscribe'
	arguments {
		email = ${Registry.get('subscriber').email}
		hash = ${Hash.generateHmac(Registry.get('subscriber').email || "")}
	}
	absolute = ${true}
	@cache {
		mode = 'uncached'
		context {
			1 = 'site'
			2 = 'documentNode'
		}
	}
}

root.automatedNewsletter {
	condition = ${q(node).is('[instanceof Sfi.Sfi:AutomatedNewsletter]')}
	renderer = Page {
		head.stylesheets = Sfi.Sfi:Stylesheets
		body = Sfi.Sfi:AutomatedNewsletter
	}
}
