{namespace neos=Neos\Neos\ViewHelpers}
<style>
    .color-brown {
        color: #6e584f !important;
    }
    .color-orange {
        color: #ff7800;
    }
    .Button--warn {
        background-color: #ff7800;
    }
    .display-flex {
        display: flex;
    }
</style>
<style>
    .donateForm .input {
        font-size: 1.125rem;
    }
    .PaymentSelector-item {
        padding: 12px 24px;
        box-shadow: 0px 0px 0px 1px #ccc inset;
    }
    .PaymentSelector-item.isActive {
        box-shadow: none;
        background-color: #ff7800;
        color: white !important;
        font-weight: bold;
    }
    .amountPicker {
        border-collapse: collapse;
        width: 100%;
    }
    .amountPicker-cell {
        width: 20%;
        border: 1px solid #ccc;
        padding: 12px 24px;
        color: #828282;
    }
    .amountPicker-cell.isActive {
        font-weight: bold;
        background-color: #ff7800;
        color: white !important;
    }
    .js-switcher-item {
        cursor: pointer;
    }
    .amountPicker .isActive .input {
        color: white;
    }
    .amountPicker .isActive .input::placeholder {
        color: white;
    }
</style>
<div class="paddingVertical-triple marginVertical-triple">
    <div class="row">
        <div style="border: 10px solid #ff7800; padding: 48px;" class="columns medium-10 medium-offset-1">
            <h2 style="margin-top: 12px; margin-bottom: 48px" class="H2 textAlign-center">{moto -> f:format.raw()}</h2>

            <form data-referer="{projectId}" class="donateForm" id="donate" method="post" name="donate" role="form">
                <div style="margin: 0" class="row PaymentSelector js-switcher">
                    <div data-value="monthly" class="textAlign-center column small-6 ParagraphAlt--Large color-grayAlt js-switcher-item PaymentSelector-item isActive">Ежемесячное пожертвование</div>
                    <div data-value="once" class="textAlign-center column small-6 ParagraphAlt--Large color-grayAlt js-switcher-item PaymentSelector-item">Разовое пожертвование</div>
                </div>

                <div class="ParagraphAlt--Small color-grayAlt marginBottom-half marginTop-double">Сумма</div>

                <table class="amountPicker marginBottom-double js-switcher">
                    <tr class="amountPicker-row">
                        <td data-value="100" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">100&nbsp;руб.</td>
                        <td data-value="200" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">200&nbsp;руб.</td>
                        <td data-value="500" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">500&nbsp;руб.</td>
                        <td data-value="1000" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell isActive">1000&nbsp;руб.</td>
                        <td data-value="1500" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">1500&nbsp;руб.</td>
                    </tr>
                    <tr class="amountPicker-row">
                        <td data-value="2000" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">2000&nbsp;руб.</td>
                        <td data-value="5000" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">5000&nbsp;руб.</td>
                        <td data-value="10000" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">10&nbsp;000&nbsp;руб.</td>
                        <td class="js-switcher-item textAlign-center ParagraphAlt--Large color-grayAlt amountPicker-cell" style="padding: 0" colspan="2">
                            <input class="input" min="0" style="background-color: transparent; margin-bottom: 0 !important; width: 100%; border: 0; text-align: center; font-size: 1.125rem;"
                                name="amount-other" placeholder="Другая сумма" type="number">
                        </td>
                    </tr>
                </table>

                <div class="row">
                    <div class="columns small-6">
                        <div class="ParagraphAlt--Small color-grayAlt marginBottom-half">
                            <label>Имя</label>
                        </div>
                        <input class="input" name="firstName" placeholder="Имя" type="text" value="">
                    </div>
                    <div class="columns small-6">
                        <div class="ParagraphAlt--Small color-grayAlt marginBottom-half">
                            <label>Фамилия</label>
                        </div>
                        <input class="input" name="lastName" placeholder="Фамилия" type="text" value="">
                    </div>
                </div>

                <div class="ParagraphAlt--Small color-grayAlt marginBottom-half">
                    <label>Ваш e-mail</label>
                </div>
                <input class="input" name="email" placeholder="your@email.ru" type="text" value="">

                <div>
                    <div>
                        <div class="row ParagraphAlt--Small color-grayAlt">
                            <div class="small-6 columns">
                                <input checked class="" name="agreeOffer" type="checkbox" disabled checked="checked"> Я ознакомился c
                                <a href="https://psmb-neos-resources.hb.bizmrg.com/target/sfi/abec2e5c8bbf1618d044a0b08aa541f30886e9f9/donation-offerta.pdf">договором-офертой</a> и согласен с ней
                            </div>
                            <div class="small-6 columns">
                                <input checked class="" name="agreeRf" type="checkbox" disabled checked="checked"> Я являюсь гражданином Российской Федерации
                            </div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 48px" class="textAlign-center">
                    <button style="width: 100%; font-weight: bold;" class="Button Button--warn" type="submit">Пожертвовать</button>
                </div>

            </form>
        </div>
    </div>
</div>


<script src="https://widget.cloudpayments.ru/bundles/cloudpayments"></script>
<script type="text/javascript"><![CDATA[

(function() {
    Array.prototype.forEach.call(document.querySelectorAll('.js-switcher'), function (root) {
        root.addEventListener('click', function (event) {
            if (event.target.classList.contains('js-switcher-item') || event.target.parentElement.classList.contains('js-switcher-item')) {
                Array.prototype.forEach.call(root.querySelectorAll('.js-switcher-item'), function (element) {
                    element.classList.remove('isActive');
                    if (element.querySelector('.input') && element.querySelector('.input').value) {
                        element.querySelector('.input').value = '';
                    }
                });
                if (event.target.classList.contains('js-switcher-item')) {
                    event.target.classList.add('isActive');
                }
                if (event.target.parentElement.classList.contains('js-switcher-item')) {
                    event.target.parentElement.classList.add('isActive');
                }
            }
        });
    });


    var form = document.getElementById('donate');
    var pay = function (event) {
        event.preventDefault();

        function getAmount() {
            var activeElement = form.querySelector('.amountPicker .isActive');
            if (activeElement.dataset.value) {
                return Number(activeElement.dataset.value);
            } else {
                var input = activeElement.querySelector('.input');
                if (input && input.value) {
                    return Number(input.value);
                } else if (input && !input.value) {
                    alert('Вы не указали сумму пожертвования!');
                }
            }
        }

        if (form.querySelector('[name=agreeOffer]').value && form.querySelector('[name=agreeRf]').value) {
            var widget = new cp.CloudPayments();
            var data = {
                firstName: form.querySelector('[name=firstName]').value,
                lastName: form.querySelector('[name=lastName]').value,
                referer: form.dataset.referer
            };
            var isRecurrent = form.querySelector('.PaymentSelector .isActive').dataset.value === 'monthly';
            if (isRecurrent) {
                data.cloudPayments = {
                    recurrent: {
                        interval: 'Month',
                        period: 1
                    }
                };
            }
            widget.charge({
                publicId: 'pk_6bca8ae9eeae557548776757180c3',
                description: 'Пожертвование на Свято-Филаретовский православно-христианский институт' + (isRecurrent ? ' (регулярное)' : ''),
                amount: getAmount(),
                currency: 'RUB',
                accountId: form.querySelector('[name=email]').value,
                data: data
            },
                'http://sfi.ru/support/thanks.html',
                function (reason, options) {
                    alert('Ошибка' + reason);
                });
        } else {
            alert('Ошибка');
        }
    };
    form.addEventListener('submit', pay);
})();
    
]]></script>