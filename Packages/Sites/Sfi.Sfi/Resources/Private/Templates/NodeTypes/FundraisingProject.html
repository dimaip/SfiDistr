{namespace neos=Neos\Neos\ViewHelpers}
<style>
	.stickyHeader {
		color: white;
		padding: 16px;
		background-color: #745a4e;
		top: 0;
		left: 0;
		right: 0;
		z-index: 1000000;
		font-family: Georgia, serif;
		border-bottom: 1px solid rgba(255, 255, 255, 0.6);
	}

	.stickyHeader-grid {
		flex-direction: column;
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin: 0 20px
	}

	.stickyHeader-grid2 {
		display: flex;
		flex-direction: column;
		align-items: center;
	}

	.digits {
		font-size: 24px;
		font-style: normal;
	}

	.stickyHeader-wording {
		font-size: 14px;
		font-style: italic
	}


	@media(max-width: 639px) {
		.stickyHeader-item {
			margin-top: 20px;
		}
	}

	@media(min-width: 640px) {
		.scrolling .stickyHeader {
			position: fixed;
		}
		.stickyHeader-item {
			margin-left: 20px;
		}
		.stickyHeader-wording {
			white-space: nowrap !important;
		}
		.stickyHeader-grid2 {
			flex-direction: row;
			margin-top: 20px;
		}
	}

	@media(min-width: 950px) {
		.stickyHeader-grid {
			flex-direction: row;
		}
		.stickyHeader-grid2 {
			margin-top: 0;
		}
	}
</style>












<style>
	.color-brown {
		color: #6e584f !important;
	}
	.color-orange {
		color: #ff7800;
	}
	.Button--warn {
		background-color: #ff7800;
	}
	.display-flex {
		display: flex;
	}
</style>

<div class="backgroundColor-gray" style="margin-top: -40px; background-image: url({imageUri}); min-height: 300px; background-size: cover;  background-position: center 92%;">
	<div class="row display-flex">
		<div class="columns medium-5 display-flex">
			<div class="backgroundColor-white marginVertical-triple padding-double">
				<div class="H1 color-brown lineHeight-single" >{neos:contentElement.editable(property: 'title')}</div>
				<div class="Paragraph marginVertical-double">{neos:contentElement.editable(property: 'description')}</div>
				<a class="Button LinkButton Button--warn" href="#donate">Хочу помочь</a>
			</div>
		</div>
		<div class="columns medium-7">
			<div class="YouTube flex-video">
				<iframe width="853" height="480" frameborder="0" src="//www.youtube.com/embed/bYnDi7jqrvk?rel=0&amp;showinfo=0" allowfullscreen=""></iframe>
			</div>
		</div>
	</div>
</div>




<div class="stickyHeader-spacer">
</div>
<div class="stickyHeader">
	<div class="row">
		<div class="stickyHeader-grid columns">
			<div style="flex-grow: 1">
				<div class="ServiceLight color-white">{title -> f:format.raw()}</div>
			</div>
			<div class="stickyHeader-grid2">
				<div class="stickyHeader-item">
					<div class="stickyHeader-wording">
						<span style="white-space:nowrap">Собрано
							<span class="digits">
								<span class="ajaxAmount">0</span>
							</span>руб.
							<span class="digits"> — </span>
						</span>
						<span style="white-space:nowrap">Нужно
							<span class="digits"> 7 000 000 </span>руб.</span>
					</div>
					<div style="background-color: white; height: 5px; width:100%; margin-top: 10px">
						<div class="progressBar" style="background-color: #ff7800; height: 5px; width:0%"></div>
					</div>
				</div>
				<div class="stickyHeader-item">
					<a href="#donate" class="Button LinkButton Button--warn">Хочу помочь</a>
				</div>
			</div>
		</div>

	</div>
</div>



<div style="margin-top: 48px">
	{main -> f:format.raw()}
</div>

<style>
	.donateForm .input {
		font-size: 1.125rem;
	}

	.PaymentSelector-item {
		padding: 12px 24px;
		box-shadow:0px 0px 0px 1px #ccc inset;
	}

	.PaymentSelector-item.isActive {
		box-shadow: none;
		background-color: #ff7800;
		color: white !important;
		font-weight: bold;
	}

	.amountPicker {
		border-collapse: collapse;
		width: 100%;
	}

	.amountPicker-cell {
		width: 20%;
		border: 1px solid #ccc;
		padding: 12px 24px;
		color: #828282;
	}

	.amountPicker-cell.isActive {
		font-weight: bold;
		background-color: #ff7800;
		color: white !important;
	}
</style>

<div class="paddingVertical-triple">
	<div class="row">
		<div style="border: 10px solid #ff7800; padding: 48px;" class="columns medium-10 medium-offset-1">
			<h2 style="margin-top: 12px; margin-bottom: 48px" class="H2 textAlign-center">{neos:contentElement.editable(property: 'moto')}</h2>

			<form data-referer="{projectId}" class="donateForm" id="donate" method="post" name="donate" role="form">
				<div style="margin: 0" class="row PaymentSelector">
					<div class="textAlign-center column small-6 ParagraphAlt--Large color-grayAlt PaymentSelector-item isActive">Ежемесячное пожертвование</div>
					<div class="textAlign-center column small-6 ParagraphAlt--Large color-grayAlt PaymentSelector-item">Разовое пожертвование</div>
				</div>
			
				<div class="ParagraphAlt--Small color-grayAlt marginBottom-half marginTop-double">Сумма</div>
				<table class="amountPicker marginBottom-double">
					<tr class="amountPicker-row">
						<td class="textAlign-center ParagraphAlt--Large color-grayAlt amountPicker-cell">100&nbsp;руб.</td>
						<td class="textAlign-center ParagraphAlt--Large color-grayAlt amountPicker-cell">200&nbsp;руб.</td>
						<td class="textAlign-center ParagraphAlt--Large color-grayAlt amountPicker-cell">500&nbsp;руб.</td>
						<td class="textAlign-center ParagraphAlt--Large color-grayAlt amountPicker-cell isActive">1000&nbsp;руб.</td>
						<td class="textAlign-center ParagraphAlt--Large color-grayAlt amountPicker-cell">1500&nbsp;руб.</td>
					</tr>
					<tr class="amountPicker-row">
						<td class="textAlign-center ParagraphAlt--Large color-grayAlt amountPicker-cell">2000&nbsp;руб.</td>
						<td class="textAlign-center ParagraphAlt--Large color-grayAlt amountPicker-cell">5000&nbsp;руб.</td>
						<td class="textAlign-center ParagraphAlt--Large color-grayAlt amountPicker-cell">10&nbsp;000&nbsp;руб.</td>
						<td class="textAlign-center ParagraphAlt--Large color-grayAlt amountPicker-cell" style="padding: 0" colspan="2"><input class="input" min="0" style="margin-bottom: 0 !important; width: 100%; border: 0; text-align: center; font-size: 1.125rem;" name="amount-other" placeholder="Другая сумма" type="number"></td>
					</tr>
				</table>
				
				
				<div class="row">
					<div class="columns small-6">
						<div class="ParagraphAlt--Small color-grayAlt marginBottom-half">
							<label>Имя</label>
						</div>
						<input class="input" name="firstName" placeholder="Имя" type="text" value="">
					</div>
					<div class="columns small-6">
						<div class="ParagraphAlt--Small color-grayAlt marginBottom-half">
							<label>Фамилия</label>
						</div>
						<input class="input" name="lastName" placeholder="Фамилия" type="text" value="">
					</div>
				</div>

				<div class="ParagraphAlt--Small color-grayAlt marginBottom-half"><label>Ваш e-mail</label></div>
				<input class="input" name="email" placeholder="your@email.ru" type="text" value="">
			
				
				<div>
					<div>
						<div class="row ParagraphAlt--Small color-grayAlt">
							<div class="small-6 columns">
								<input checked class="" name="agreeOffer" type="checkbox" disabled checked="checked"> Я ознакомился c
								<a href="https://psmb-neos-resources.hb.bizmrg.com/target/sfi/abec2e5c8bbf1618d044a0b08aa541f30886e9f9/donation-offerta.pdf">договором-офертой</a> и согласен с ней
							</div>
							<div class="small-6 columns">
								<input checked class="" name="agreeRf" type="checkbox" disabled checked="checked"> Я являюсь гражданином Российской Федерации
							</div>
						</div>
						<div class="ParagraphAlt--Small color-grayAlt">
						</div>
					</div>
				</div>
				<div style="margin-top: 48px" class="textAlign-center">
					<button style="width: 100%; font-weight: bold;" class="Button Button--warn" type="submit">Пожертвовать</button>
				</div>


			</form>
		</div>
	</div>
</div>

<script src="https://widget.cloudpayments.ru/bundles/cloudpayments"></script>
<script type="text/javascript"><![CDATA[
	var amountPickerOtherOption = document.querySelector('.amountPicker-otherOption');
	var amountPickerOtherInput = document.querySelector('.amountPicker-otherInput');
	var amountPickerInputs = document.querySelectorAll('.amountPicker input');
	Array.prototype.forEach.call(amountPickerInputs, function (item) {
		item.addEventListener('change', function (event) {
			amountPickerOtherInput.style.display = event.target.value === 'other' ? 'block' : 'none';
		});
	});

	var form = document.getElementById('donate');
	var pay = function (event) {
		event.preventDefault();

		function getAmount() {
			if (amountPickerOtherOption.checked === true) {
				var otherAmount = Number(form.querySelector('[name=amount-other]').value);
				if (otherAmount > 0) {
					return otherAmount;
				} else {
					alert('Кажется вы не указали размер платежа! :-(');
				}

			} else {
				return Number(form.querySelector('[name=amount]:checked').value);
			}
		}

		if (form.querySelector('[name=agreeOffer]').value && form.querySelector('[name=agreeRf]').value) {
			var widget = new cp.CloudPayments();
			var data = {
				firstName: form.querySelector('[name=firstName]').value,
				lastName: form.querySelector('[name=lastName]').value,
				referer: form.dataset.referer
			};
			var isRecurrent = form.querySelector('[name=type]').value === 'monthly';
			if (isRecurrent) {
				data.cloudPayments = {
					recurrent: {
						interval: 'Month',
						period: 1
					}
				};
			}
			widget.charge({
				publicId: 'pk_6bca8ae9eeae557548776757180c3',
				description: 'Пожертвование на Свято-Филаретовский православно-христианский институт' + (isRecurrent ? ' (регулярное)' : ''),
				amount: getAmount(),
				currency: 'RUB',
				accountId: form.querySelector('[name=email]').value,
				data: data
			},
				'http://sfi.ru/support/thanks.html',
				function (reason, options) {
					alert('Ошибка' + reason);
				});
		} else {
			alert('Ошибка');
		}
	};
	form.addEventListener('submit', pay);
]]></script>


<script>< ![CDATA[
	window.addEventListener('scroll', function (event) {
		if (window.pageYOffset > 500) {
			document.body.classList.add('scrolling');
		} else {
			document.body.classList.remove('scrolling');
		}
	});

	function formatAmount(amount) {
		var a = String(amount);
		var res = "";
		for (var i = a.length; i > 0; i--) {
			var revI = a.length - i;

			if (revI % 3 === 0 && revI !== 0) {
				res = " " + res;
			}
			res = a[i - 1] + res;
		}
		return res;
	}


	var amount = 0;

	function updatePlaceholders(amount) {
		Array.prototype.forEach.call(document.querySelectorAll('.ajaxAmount'), function (placeholder) {
			placeholder.textContent = formatAmount(amount);
		});
		Array.prototype.forEach.call(document.querySelectorAll('.progressBar'), function (progressBar) {
			progressBar.style.width = String(100 * (amount / 7000000)) + '%';
		});
	}


	var request = new XMLHttpRequest();
	var form = document.getElementById('donate');
	request.open('GET', 'http://payments.sfi.ru:8585/getAmountDonate?referer=' + document.getElementById('donate').dataset.referer, true);

	request.onload = function () {
		if (this.status >= 200 && this.status < 400) {
			var responseData = JSON.parse(this.response);
			amount = Number(responseData.amount) + 1500000 + 20500;
			updatePlaceholders(amount);
		} else {
		}
	};

	request.onerror = function () {
		// There was a connection error of some sort
	};

	request.send();
]]></script>
